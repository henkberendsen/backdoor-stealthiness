import pandas as pd
import numpy as np

# ==========================================
# 1. SETUP LISTS & KEYS
# ==========================================
datasets = ["CIFAR-10", "Imagenette"]

# REMOVED: "dfba"
attacks = [
    "badnet", "blended", "wanet", "bpp", 
    "narcissus", "adaptive_patch", "adaptive_blend", 
    "dfst", "grond"
]
prs = [0.05, 0.003]  # High (5%) and Low (0.3% / 2%)

# ==========================================
# 2. METRICS DATA (Organized by Dataset)
# ==========================================

# A. INPUT SPACE METRICS (Constant per attack)
# Order: [l1, l2, l_inf, MSE, PSNR, SSIM, LPIPS, IS, pHash, SAM]
input_metrics = {
    "CIFAR-10": {
        "badnet":         [13.2, 2.84, 0.811, 2.64e-3, 25.8, 0.956, 4.41e-3, 0.170, 95.2, 1.44e-3],
        "blended":        [230, 4.92, 0.191, 8.01e-3, 21.0, 0.784, 0.0483, 2.37, 89.8, 0.0830],
        "wanet":          [46.5, 1.42, 0.173, 7.17e-4, 31.5, 0.978, 4.32e-3, 0.270, 96.1, 0.0119],
        "bpp":            [24.6, 0.525, 0.0196, 8.97e-5, 40.5, 0.992, 1.94e-4, 0.150, 99.2, 0.0239],
        "adaptive_patch": [74.1, 6.77, 0.913, 0.0151, 18.2, 0.956, 0.0120, 0.724, 87.7, 8.94e-3],
        "adaptive_blend": [232, 4.97, 0.192, 8.15e-3, 20.9, 0.783, 0.0485, 2.37, 89.8, 0.0831],
        "dfst":           [487, 10.8, 0.489, 0.0400, 14.0, 0.719, 0.165, 2.22, 88.6, 0.316],
        "narcissus":      [542, 9.98, 0.188, 0.0325, 14.9, 0.532, 0.184, 3.68, 82.2, 0.331],
        "grond":          [87.6, 1.62, 0.0348, 8.59e-4, 30.7, 0.934, 2.92e-3, 0.918, 97.9, 0.0833]
    },
    "Imagenette": {
        "badnet":         [73.3, 6.94, 0.879, 2.54e-3, 26.0, 0.981, 0.0152, 0.0331, 97.2, 1.44e-3],
        "blended":        [1620, 13.8, 0.198, 0.0100, 20.0, 0.697, 0.203, 3.10, 89.9, 0.0968],
        "wanet":          [225, 2.94, 0.190, 4.94e-4, 33.3, 0.981, 0.0140, 0.0775, 98.0, 0.0111],
        "bpp":            [151, 1.30, 0.0196, 8.79e-5, 40.6, 0.983, 1.87e-3, 0.0990, 99.4, 0.0294],
        "adaptive_patch": [424, 16.7, 0.960, 0.0147, 18.4, 0.955, 0.0540, 0.238, 86.9, 9.00e-3],
        "adaptive_blend": [1640, 13.9, 0.198, 0.0102, 19.9, 0.697, 0.203, 3.09, 89.9, 0.0969],
        "dfst":           [3220, 28.9, 0.532, 0.0456, 13.5, 0.692, 0.335, 1.52, 88.1, 0.334],
        "narcissus":      [3310, 24.6, 0.188, 0.0317, 15.0, 0.615, 0.428, 3.37, 82.8, 0.268],
        "grond":          [476, 3.66, 0.0352, 7.00e-4, 31.6, 0.882, 0.0482, 1.02, 99.1, 0.0521]
    }
}

# B. FEATURE & PARAMETER METRICS (Vary by PR)
# Order: [SS, DSWD, BMS, UCLC, TAC, CDBI, TUP]
fp_metrics = {
    "CIFAR-10": {
        "badnet": {0.05: [0.507, 2.01, 34.00, 6.59, 3.90, 0.574, 16.2], 0.003: [0.355, 2.54, 76.61, 7.99, 8.03, 0.627, 23.1]},
        "blended": {0.05: [0.473, 2.05, 38.02, 6.49, 3.05, 0.738, 3.68], 0.003: [0.276, 2.08, 48.66, 5.76, 4.30, 0.796, 3.94]},
        "wanet": {0.05: [0.382, 1.83, 32.71, 6.33, 10.7, 0.641, 9.30], 0.003: [0.378, 1.62, 18.76, 7.68, 14.3, 0.644, 8.56]},
        "bpp": {0.05: [0.500, 1.91, 97.43, 9.42, 8.50, 0.640, 21.0], 0.003: [0.371, 0.952, 16.10, 7.38, 7.48, 0.519, 10.9]},
        "adaptive_patch": {0.05: [0.254, 0.765, 44.03, 10.7, 6.44, 1.29, 8.38], 0.003: [0.0500, 1.91, 42.22, 9.91, 3.94, 3.42, 10.2]},
        "adaptive_blend": {0.05: [0.231, 1.15, 41.84, 5.60, 2.14, 1.66, 3.34], 0.003: [0.149, 2.10, 45.98, 7.70, 4.58, 5.19, 3.63]},
        "dfst": {0.05: [0.519, 2.26, 82.34, 6.16, 6.41, 0.650, 3.70], 0.003: [0.339, 2.63, 103.91, 6.37, 11.8, 0.550, 4.47]},
        "narcissus": {0.05: [0.491, 2.23, 50.21, 7.37, 6.23, 0.767, 2.15], 0.003: [-0.0070, 1.90, 25.68, 6.88, 2.15, 5.92, 2.13]},
        "grond": {0.05: [0.435, 1.82, 27.77, 3.60, 2.43, 0.868, 1.87], 0.003: [-0.101, 1.65, 6.14, 3.18, 2.30, 5.81, 1.78]}
    },
    "Imagenette": {
        "badnet": {0.05: [0.588, 1.78, 51.47, 6.22, 15.3, 0.418, 18.4], 0.003: [0.260, 1.49, 48.40, 5.39, 18.4, 0.871, 19.3]},
        "blended": {0.05: [0.0216, 1.60, 27.40, 4.99, 6.24, 3.07, 3.30], 0.003: [0.0975, 1.27, 25.45, 5.37, 6.04, 2.20, 2.77]},
        "wanet": {0.05: [0.557, 1.73, 24.81, 7.05, 64.0, 0.571, 8.85], 0.003: [0.192, 0.474, 15.29, 6.49, 2.55, 0.809, 3.84]},
        "bpp": {0.05: [0.607, 1.34, 142.88, 8.82, 59.2, 0.518, 13.9], 0.003: [0.227, 0.0402, 14.48, 5.19, 0.394, 0.854, 1.56]},
        "adaptive_patch": {0.05: [0.0822, 0.588, 26.72, 6.24, 11.5, 2.90, 5.72], 0.003: [-0.0455, 0.106, 14.28, 7.62, 1.42, 4.45, 2.35]},
        "adaptive_blend": {0.05: [0.0630, 1.26, 22.74, 5.08, 5.61, 3.00, 3.29], 0.003: [-0.0657, 0.965, 18.05, 5.67, 4.71, 12.3, 2.45]},
        "dfst": {0.05: [0.641, 2.20, 127.10, 6.29, 18.9, 0.476, 3.81], 0.003: [0.261, 2.15, 54.43, 4.61, 10.8, 0.934, 4.43]},
        "narcissus": {0.05: [0.0431, 1.34, 20.00, 5.41, 5.59, 4.27, 2.64], 0.003: [-0.0164, 0.883, 14.90, 6.42, 4.64, 7.54, 2.13]},
        "grond": {0.05: [0.0308, 1.05, 22.79, 3.14, 4.20, 24.0, 1.61], 0.003: [0.0546, 0.286, 14.83, 3.73, 2.19, 12.4, 1.05]}
    }
}

# ==========================================
# 3. DEFENSE DATA (All 9 Defenses + TABOR)
# ==========================================

# 1. F1 Scores (Order: [SPECTRE, STRIP, SS])
def_f1 = {
    "CIFAR-10": {
        "adaptive_blend": {0.05: [0.056, 0.016, 0.010], 0.003: [0.006, 0.018, 0.000]},
        "adaptive_patch": {0.05: [0.081, 0.107, 0.052], 0.003: [0.006, 0.723, 0.001]},
        "badnet":         {0.05: [0.120, 0.995, 0.217], 0.003: [0.008, 0.995, 0.038]},
        "blended":        {0.05: [0.053, 0.993, 0.000], 0.003: [0.006, 0.970, 0.011]},
        "bpp":            {0.05: [0.117, 0.878, 0.110], 0.003: [0.007, 0.903, 0.001]},
        "dfst":           {0.05: [0.067, 0.000, 0.001], 0.003: [0.006, 0.000, 0.000]},
        "grond":          {0.05: [0.089, 0.061, 0.099], 0.003: [0.006, 0.073, 0.010]},
        "narcissus":      {0.05: [0.080, 0.995, 0.000], 0.003: [0.006, 0.963, 0.006]},
        "wanet":          {0.05: [0.089, 0.943, 0.001], 0.003: [0.007, 0.807, 0.001]}
    },
    "Imagenette": {
        "adaptive_blend": {0.05: [0.063, 0.188, 0.022], 0.003: [0.006, 0.030, 0.000]},
        "adaptive_patch": {0.05: [0.078, 0.697, 0.017], 0.003: [0.005, 0.127, 0.000]},
        "badnet":         {0.05: [0.116, 0.978, 0.220], 0.003: [0.008, 0.960, 0.039]},
        "blended":        {0.05: [0.054, 0.977, 0.158], 0.003: [0.005, 0.857, 0.033]},
        "bpp":            {0.05: [0.096, 0.793, 0.202], 0.003: [0.010, 0.825, 0.001]},
        "dfst":           {0.05: [0.051, 0.007, 0.000], 0.003: [0.006, 0.055, 0.000]},
        "grond":          {0.05: [0.093, 0.244, 0.074], 0.003: [0.006, 0.216, 0.007]},
        "narcissus":      {0.05: [0.088, 0.877, 0.054], 0.003: [0.006, 0.423, 0.006]},
        "wanet":          {0.05: [0.071, 0.933, 0.061], 0.003: [0.008, 0.893, 0.000]}
    }
}

# 2. CLP Defense (Post-Pruning ASR)
def_clp = {
    "CIFAR-10": {
        "badnet": {0.05: 11.36, 0.003: 99.72},
        "blended": {0.05: 95.87, 0.003: 90.68},
        "wanet": {0.05: 24.72, 0.003: 0.76},
        "bpp": {0.05: 0.7, 0.003: 0.45}, 
        "adaptive_patch": {0.05: 11.43, 0.003: 37.54},
        "adaptive_blend": {0.05: 54.32, 0.003: 44.0},
        "dfst": {0.05: 39.11, 0.003: 79.02},
        "narcissus": {0.05: 99.92, 0.003: 92.13},
        "grond": {0.05: 92.64, 0.003: 72.55}
    },
    "Imagenette": {
        "badnet": {0.05: 47.23, 0.003: 0.53},
        "blended": {0.05: 98.93, 0.003: 76.17},
        "wanet": {0.05: 69.19, 0.003: 87.45},
        "bpp": {0.05: 1.92, 0.003: 1.02}, 
        "adaptive_patch": {0.05: 33.04, 0.003: 10.24},
        "adaptive_blend": {0.05: 95.41, 0.003: 72.07},
        "dfst": {0.05: 98.42, 0.003: 98.21},
        "narcissus": {0.05: 83.38, 0.003: 45.92},
        "grond": {0.05: 52.48, 0.003: 2.01}
    }
}

# 3. I-BAU Defense (Post-Unlearning ASR)
def_ibau = {
    "CIFAR-10": {
        "adaptive_blend": {0.05: 8.3, 0.003: 5.6},
        "adaptive_patch": {0.05: 11.2, 0.003: 8.0},
        "badnet":         {0.05: 34.6, 0.003: 2.8},
        "blended":        {0.05: 33.3, 0.003: 0.0},
        "bpp":            {0.05: 33.4, 0.003: 34.0},
        "dfst":           {0.05: 23.3, 0.003: 5.8},
        "grond":          {0.05: 3.3, 0.003: 16.8},
        "narcissus":      {0.05: 14.5, 0.003: 0.0},
        "wanet":          {0.05: 32.7, 0.003: 33.8}
    },
    "Imagenette": {
        "adaptive_blend": {0.05: 2.9, 0.003: 1.9},
        "adaptive_patch": {0.05: 2.1, 0.003: 0.1},
        "badnet":         {0.05: 0.0, 0.003: 0.0},
        "blended":        {0.05: 0.0, 0.003: 0.1},
        "bpp":            {0.05: 0.1, 0.003: 0.0},
        "dfst":           {0.05: 0.8, 0.003: 1.0},
        "grond":          {0.05: 1.1, 0.003: 1.6},
        "narcissus":      {0.05: 0.0, 0.003: 0.0},
        "wanet":          {0.05: 0.0, 0.003: 0.0}
    }
}

# 4. Neural Cleanse (NC) - Reversed Norm
def_nc = {
    "CIFAR-10": {
        "badnet": {0.05: 136.8, 0.003: 118.3},
        "blended": {0.05: 214.4, 0.003: 305.5},
        "wanet": {0.05: 222.0, 0.003: 323.2},
        "bpp": {0.05: 253.0, 0.003: 161.1},
        "adaptive_patch": {0.05: 299.2, 0.003: 170.8},
        "adaptive_blend": {0.05: 255.8, 0.003: 299.5},
        "dfst": {0.05: 246.3, 0.003: 292.2},
        "narcissus": {0.05: 181.4, 0.003: 239.4},
        "grond": {0.05: 225.986, 0.003: 282.294}
    },
    "Imagenette": {
        "badnet":         {0.05: 230.830, 0.003: 453.184},
        "blended":        {0.05: 627.689, 0.003: 848.250},
        "wanet":          {0.05: 857.005, 0.003: 773.287},
        "bpp":            {0.05: 190.388, 0.003: 713.540},
        "adaptive_patch": {0.05: 372.325, 0.003: 1020.848},
        "adaptive_blend": {0.05: 672.295, 0.003: 888.594},
        "dfst":           {0.05: 819.277, 0.003: 814.905},
        "narcissus":      {0.05: 932.268, 0.003: 878.910},
        "grond":          {0.05: 552.044, 0.003: 1105.304}
    }
}

# 5. FeatureRE (Recovered Trigger ASR)
def_fre = {
    "CIFAR-10": {
        "badnet": {0.05: 7.77, 0.003: 34.44},
        "blended": {0.05: 14.44, 0.003: 11.11},
        "wanet": {0.05: 97.78, 0.003: 56.67},
        "bpp": {0.05: 23.33, 0.003: 47.78},
        "adaptive_patch": {0.05: 65.56, 0.003: 87.78},
        "adaptive_blend": {0.05: 93.33, 0.003: 95.56},
        "dfst": {0.05: 57.78, 0.003: 75.56},
        "narcissus": {0.05: 53.33, 0.003: 11.11},
        "grond": {0.05: 12.22, 0.003: 4.44}
    },
    "Imagenette": {
        "badnet": {0.05: 93.83, 0.003: 81.48},
        "blended": {0.05: 75.31, 0.003: 38.27},
        "wanet": {0.05: 100.0, 0.003: 30.86},
        "bpp": {0.05: 100.0, 0.003: 81.48},
        "adaptive_patch": {0.05: 77.78, 0.003: 64.2},
        "adaptive_blend": {0.05: 82.72, 0.003: 55.56},
        "dfst": {0.05: 90.12, 0.003: 50.62},
        "narcissus": {0.05: 44.44, 0.003: 69.14},
        "grond": {0.05: 45.68, 0.003: 64.2}
    }
}

# 6. TABOR (Score for Target Class 0)
def_tabor = {
    "CIFAR-10": {
        "badnet": {0.05: 194.86, 0.003: 175.40},
        "blended": {0.05: 251.00, 0.003: 350.76},
        "wanet": {0.05: 241.89, 0.003: 358.66},
        "bpp": {0.05: 283.23, 0.003: 188.46},
        "adaptive_patch": {0.05: 339.43, 0.003: 213.35},
        "adaptive_blend": {0.05: 292.93, 0.003: 329.12},
        "dfst": {0.05: 324.40, 0.003: 376.97},
        "narcissus": {0.05: 208.73, 0.003: 284.75},
        "grond": {0.05: 253.89, 0.003: 325.57}
    },
    "Imagenette": {
        "badnet": {0.05: 234.713, 0.003: 463.869},
        "blended": {0.05: 638.591, 0.003: 857.801},
        "wanet": {0.05: 861.028, 0.003: 777.157},
        "bpp": {0.05: 198.392, 0.003: 721.787},
        "adaptive_patch": {0.05: 376.740, 0.003: 1030.888},
        "adaptive_blend": {0.05: 683.304, 0.003: 903.251},
        "dfst": {0.05: 830.711, 0.003: 823.215},
        "narcissus": {0.05: 943.413, 0.003: 888.085},
        "grond": {0.05: 561.010, 0.003: 1118.896}
    }
}

# 7. BTI-DBF (Detected Samples)
def_bti = {
    "CIFAR-10": {
        "badnet": {0.05: 2499, 0.003: 0},
        "blended": {0.05: 0, 0.003: 1101},
        "wanet": {0.05: 46, 0.003: 0},
        "bpp": {0.05: 0, 0.003: 0},
        "adaptive_patch": {0.05: 1969, 0.003: 0},
        "adaptive_blend": {0.05: 0, 0.003: 577},
        "dfst": {0.05: 0, 0.003: 0},
        "narcissus": {0.05: 0, 0.003: 2500},
        "grond": {0.05: 0, 0.003: 1813}
    },
    "Imagenette": {
        "badnet": {0.05: 0, 0.003: 0},
        "blended": {0.05: 9129, 0.003: 0},
        "wanet": {0.05: 0, 0.003: 0},
        "bpp": {0.05: 0, 0.003: 32},
        "adaptive_patch": {0.05: 0, 0.003: 38},
        "adaptive_blend": {0.05: 0, 0.003: 0},
        "dfst": {0.05: 245, 0.003: 196},
        "narcissus": {0.05: 0, 0.003: 0},
        "grond": {0.05: 0, 0.003: 0}
    }
}

# 8. BAN (Detected Samples)
def_ban = {
    "CIFAR-10": {
        "badnet": {0.05: 5000, 0.003: 451},
        "blended": {0.05: 914, 0.003: 531},
        "wanet": {0.05: 4721, 0.003: 5000},
        "bpp": {0.05: 1884, 0.003: 5000},
        "adaptive_patch": {0.05: 5000, 0.003: 765},
        "adaptive_blend": {0.05: 1313, 0.003: 946},
        "dfst": {0.05: 5000, 0.003: 468},
        "narcissus": {0.05: 448, 0.003: 417},
        "grond": {0.05: 538, 0.003: 586}
    },
    "Imagenette": {
        "badnet": {0.05: 288, 0.003: 50},
        "blended": {0.05: 104, 0.003: 27},
        "wanet": {0.05: 941, 0.003: 209},
        "bpp": {0.05: 715, 0.003: 0},
        "adaptive_patch": {0.05: 947, 0.003: 596},
        "adaptive_blend": {0.05: 947, 0.003: 7},
        "dfst": {0.05: 947, 0.003: 0},
        "narcissus": {0.05: 0, 0.003: 116},
        "grond": {0.05: 45, 0.003: 79}
    }
}

# 9. ASR Before (Baseline Attack Success Rate)
asr_before_data = {
    "CIFAR-10": {
        "badnet": {0.05: 100, 0.003: 100},
        "blended": {0.05: 99.8, 0.003: 94.8},
        "wanet": {0.05: 98.5, 0.003: 95.3}, # Corrected 0.3% -> 95.3 (PR=2%)
        "bpp": {0.05: 99.8, 0.003: 69.5}, 
        "adaptive_patch": {0.05: 30.1, 0.003: 92.2},
        "adaptive_blend": {0.05: 53.9, 0.003: 87.9},
        "dfst": {0.05: 100, 0.003: 100},
        "narcissus": {0.05: 100, 0.003: 98.9},
        "grond": {0.05: 92.9, 0.003: 76.6}
    },
    "Imagenette": {
        "badnet": {0.05: 100.0, 0.003: 86.7},
        "blended": {0.05: 98.9, 0.003: 73.5},
        "wanet": {0.05: 97.2, 0.003: 61.0},
        "bpp": {0.05: 73.6, 0.003: 1.02},
        "adaptive_patch": {0.05: 20.2, 0.003: 0.565}, 
        "adaptive_blend": {0.05: 94.9, 0.003: 54.4},  
        "dfst": {0.05: 99.5, 0.003: 99.7},            
        "narcissus": {0.05: 86.1, 0.003: 13.6},
        "grond": {0.05: 60.2, 0.003: 1.81}
    }
}

# ==========================================
# 4. BUILD DATAFRAME
# ==========================================
rows = []
for dataset in datasets:
    for atk in attacks:
        for pr in prs:
            # Metrics
            in_m = input_metrics[dataset][atk]
            fp_m = fp_metrics[dataset][atk][pr]
            
            # Defenses
            f1 = def_f1[dataset][atk][pr]
            
            row = {
                "Dataset": dataset,
                "Attack": atk,
                "PR": pr,
                # Input Metrics
                "l1": in_m[0], "l2": in_m[1], "l_inf": in_m[2], "MSE": in_m[3],
                "PSNR": in_m[4], "SSIM": in_m[5], "LPIPS": in_m[6], "IS": in_m[7], "pHash": in_m[8], "SAM": in_m[9],
                # Feature/Param Metrics
                "SS": fp_m[0], "DSWD": fp_m[1], "BMS": fp_m[2],
                "UCLC": fp_m[3], "TAC": fp_m[4],
                "CDBI": fp_m[5], "TUP": fp_m[6],
                # Defense Results
                "SPECTRE_F1": f1[0], 
                "STRIP_F1": f1[1], 
                "SS_F1": f1[2],
                "CLP_ASR": def_clp[dataset][atk][pr],
                "IBAU_ASR": def_ibau[dataset][atk][pr],
                "NC_Norm": def_nc[dataset][atk][pr],
                "FeatureRE_ASR": def_fre[dataset][atk][pr],
                "TABOR_Score": def_tabor[dataset][atk][pr],
                "BTI_Detected": def_bti[dataset][atk][pr],
                "BAN_Detected": def_ban[dataset][atk][pr],
                "ASR_Before": asr_before_data[dataset][atk][pr]
            }
            rows.append(row)

df = pd.DataFrame(rows)

print("Full Dataset (CIFAR-10 + Imagenette) Created Successfully!")
print(df.groupby('Dataset').size())
print(df.head())

df.to_csv("dataframing_results_df.csv", index=False)